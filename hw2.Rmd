---
title: "hw2"
output: github_document
date: "2022-10-02"
---

```{r}
library(tidyverse)
library(readxl)
library(dplyr)
```


### Problem 1

Below we import and clean data from `NYC_Transit_Subway_Entrance_And_Exit_Data.csv`. The process begins with data import, updates variable names, and selects the columns that will be used in later parts fo this problem. We update `entry` from `yes` / `no` to a logical variable. As part of data import, we specify that `Route` columns 8-11 should be character for consistency with 1-7.

```{r}
trans_ent = 
  read_csv(
    "/Users/jag/Downloads/NYC_Transit_Subway_Entrance_And_Exit_Data.csv",
    col_types = cols(Route8 = "c", Route9 = "c", Route10 = "c", Route11 = "c")) %>% 
  janitor::clean_names() %>% 
  select(
    line, station_name, station_latitude, station_longitude, 
    starts_with("route"), entry, exit_only, vending, entrance_type, 
    ada) %>% 
  mutate(entry = ifelse(entry == "YES", TRUE, FALSE))
```

As it stands, these data are not "tidy": route number should be a variable, as should route. That is, to obtain a tidy dataset we would need to convert `route` variables from wide to long format. This will be useful when focusing on specific routes, but may not be necessary when considering questions that focus on station-level variables. 

The following code chunk selects station name and line, and then uses `distinct()` to obtain all unique combinations. As a result, the number of rows in this dataset is the number of unique stations.

```{r}
trans_ent %>% 
  select(station_name, line) %>% 
  distinct
```

The next code chunk is similar, but filters according to ADA compliance as an initial step. This produces a dataframe in which the number of rows is the number of ADA compliant stations. 

```{r}
trans_ent %>% 
  filter(ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct
```

To compute the proportion of station entrances / exits without vending allow entrance, we first exclude station entrances that do not allow vending. Then, we focus on the `entry` variable -- this logical, so taking the mean will produce the desired proportion (recall that R will coerce logical to numeric in cases like this).

```{r}
trans_ent %>% 
  filter(vending == "NO") %>% 
  pull(entry) %>% 
  mean
```

Lastly, we write a code chunk to identify stations that serve the A train, and to assess how many of these are ADA compliant. As a first step, we tidy the data as alluded to previously; that is, we convert `route` from wide to long format. After this step, we can use tools from previous parts of the question (filtering to focus on the A train, and on ADA compliance; selecting and using `distinct` to obtain dataframes with the required stations in rows).

```{r}
trans_ent %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") %>% 
  filter(route == "A") %>% 
  select(station_name, line) %>% 
  distinct

trans_ent %>% 
  pivot_longer(
    route1:route11,
    names_to = "route_num",
    values_to = "route") %>% 
  filter(route == "A", ada == TRUE) %>% 
  select(station_name, line) %>% 
  distinct
```


# Problem 2

Reading the excel file and cleaning th data
```{r}

df_trash <- read_excel("/Users/jag/Downloads/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
    sheet = "Mr. Trash Wheel",
    range = "A2:N408",
    )

#### cleaning the data
df_trash <-
    df_trash %>%
    janitor::clean_names() %>%
    drop_na() %>%
    mutate(type_trash = "Mr.Trash")
```


Rounding the number of sports balls to the nearest integer and converts the result to an integer variable:
```{r}
df_trash <-
  df_trash %>%
  filter(!str_detect(month, "Total")) %>%

  mutate(sports_balls = as.integer(round(sports_balls, digits = 0)))

df_trash
```

Reading professor trash wheel:
```{r}
pf_trash <- read_excel("/Users/jag/Downloads/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
    sheet = "Professor Trash Wheel",
    range = "A2:N408") %>%
    drop_na()
#### cleaning the data
pf_trash <-
    pf_trash %>%
    janitor::clean_names() %>%
    mutate(type_trash = "Pr.Trash")
```

```{r}
merged_df <- 
  rbind(df_trash, pf_trash)
```


```{r}
merged_df %>%
  filter(type_trash == "Pr.Trash") %>%
  select(weight_tons) %>%
  sum()


merged_df %>%
  group_by(type_trash) %>%
  summarise(sum(weight_tons))

sum(merged_df[merged_df$type_trash=="Pr.Trash", "weight_tons"])
sum(merged_df[merged_df$type_trash=="Mr.Trash", "sports_balls"])

```

# Problem 3

Reading pols-months from FiveThirtyEight data. 
```{r}
pol_df <- 
  read_csv("/Users/jag/Downloads/fivethirtyeight_datasets/pols-month.csv") %>%
  janitor::clean_names()


#Use separate() to break up the variable mon into integer variables year, month, and day
pol_df <- pol_df%>%
  separate(col = mon, into = c("year","month", "day")) %>%
  mutate(across(.cols = c(year, month, day), as.integer)) %>%
  mutate(month = month.name[month]) 

#president variable taking values gop and dem
pol_df <- pol_df%>%
  mutate(president = case_when(prez_dem == 1 ~ "dem", 
                               prez_gop == 1 ~ "gop",
                              prez_gop == 2 ~ "gop")) 

#president variable taking values gop and dem
pol_df <- pol_df%>%
  select(everything(), -day, -prez_dem, -prez_gop)


```

Reading the snp data
```{r}
snp_df <- 
  read_csv("/Users/jag/Downloads/fivethirtyeight_datasets/snp.csv") %>%
  janitor::clean_names()
```



```{r}
snp_df <- snp_df %>%
  separate(date, sep = "/", into = c("month", "day", "year")) %>%
  mutate(across(.cols = c(month, day, year), as.integer)) %>%
  mutate(month = month.name[month])  %>%
  mutate(year = ifelse(year > 21, 
                       1900 + year, 
                       2000 + year)) %>%
  select(year, month, close)

```

Import and cleaning the uneployment data

```{r}
#### First we will clean the column names ####
ue_df <- read_csv("/Users/jag/Downloads/fivethirtyeight_datasets/unemployment.csv") %>%
  janitor::clean_names() 


####### the months into a column so that we can merge
ue_df <- ue_df %>%
  pivot_longer(
    jan:dec,
    names_to = "month",
    values_to = "percentage") 
```


Correcting the year values from the acronyms to full month names:
```{r}
ue_df <-ue_df %>%
  mutate(across(.col = c(year), as.integer)) %>%
  mutate(month = recode(month, "jan" = "January", "feb" = "February", "mar" = "March", "apr" = "April", "may" = "May", "jun" = "June",                                "jul" = "July", "aug" = "August", "sep" = "September", "oct" = "October", "nov" = "November", "dec" =                                  "December"))
```

```{r}
pol_snp_df <- left_join(pol_df, snp_df, by = c("year", "month"))
net_df <-left_join(pol_snp_df, ue_df, by = c("year", "month"))
```


